From 804cbc17639e38abf9855a7d09cf173ebfde5323 Mon Sep 17 00:00:00 2001
From: guokuan <guokuan1@huawei.com>
Date: Mon, 8 Dec 2025 14:16:58 +0800
Subject: [PATCH] [Backport]Out-of-Bounds Access Risk
CVE:CVE-2025-66293
Reference:https://github.com/pnggroup/libpng/issues/764
---
 pngrtran.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/pngrtran.c b/pngrtran.c
index 31be668..7002044 100644
--- a/pngrtran.c
+++ b/pngrtran.c
@@ -1765,6 +1765,7 @@ png_init_read_transformations(png_structrp png_ptr)
              * transformations elsewhere.
              */
             png_ptr->transformations &= ~(PNG_COMPOSE | PNG_GAMMA);
+            png_ptr->flags &= ~PNG_FLAG_OPTIMIZE_ALPHA;
          } /* color_type == PNG_COLOR_TYPE_PALETTE */
 
          /* if (png_ptr->background_gamma_type!=PNG_BACKGROUND_GAMMA_UNKNOWN) */
-- 
2.1.4

