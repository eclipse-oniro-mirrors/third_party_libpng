diff --git a/pngrtran.c b/pngrtran.c
index 7002044..c631164 100644
--- a/pngrtran.c
+++ b/pngrtran.c
@@ -651,8 +651,8 @@ png_set_quantize(png_structrp png_ptr, png_colorp palette,
                          break;
 
                      t->next = hash[d];
-                     t->left = (png_byte)i;
-                     t->right = (png_byte)j;
+                     t->left = png_ptr->palette_to_index[i];
+                     t->right = png_ptr->palette_to_index[j];
                      hash[d] = t;
                   }
                }
-- 
2.1.4

